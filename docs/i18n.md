# proofscan i18n (Internationalization)

## 概要

proofscan の i18n サポートは、**翻訳のためではなく、文字列管理の統一**を目的としています。

- UX は原則そのまま（英語ファースト）
- ユーザー向け文言はすべて `t()` 経由で管理
- `locales/en.ts` が source of truth
- AI が迷わず増築できる構造

## 使い方

### 言語の切り替え

環境変数で言語を切り替えます：

```bash
# 日本語出力
PFSCAN_LANG=ja pfscan analyze --session abc123

# 英語出力（デフォルト）
pfscan analyze --session abc123

# または LANG 環境変数から自動検出
LANG=ja_JP.UTF-8 pfscan analyze
```

**優先順位:**
1. `PFSCAN_LANG` (e.g., `ja`, `en`)
2. `LC_ALL` / `LANG` (先頭2文字を使用)
3. `en` (デフォルト)

### キー一覧の確認

```bash
# 全キーを表示
pfscan i18n keys

# プレフィックスでフィルタ
pfscan i18n keys --prefix category.
pfscan i18n keys --prefix analyze.

# JSON出力
pfscan i18n keys --json
```

## 対象/非対象

### i18n 対象
- `analyze` / `summary` / `record` の出力ラベル
- カテゴリラベル（Read, Write, Network, Exec, Other）
- エラーメッセージ
- ヒント・ガイダンス
- ステータス表示

### i18n 非対象（英語直書きで維持）
- `.description()` ヘルプテキスト
- `.addHelpText()` の例示
- CLI usage examples
- ログメッセージ（デバッグ用）

## 開発者向け

### 新しい文字列を追加する

1. まず `src/i18n/locales/en.ts` に英語キーを追加：

```typescript
export const en = {
  // ... existing keys ...

  myCommand: {
    title: 'My Command',
    success: 'Operation completed successfully',
    error: 'Operation failed: {error}',
  },
} as const;
```

2. 必要に応じて `src/i18n/locales/ja.ts` に日本語訳を追加：

```typescript
export const ja: LocaleMessages = {
  // ... existing keys ...

  myCommand: {
    title: 'マイコマンド',
    success: '操作が正常に完了しました',
    error: '操作が失敗しました: {error}',
  },
};
```

3. コードで使用：

```typescript
import { t } from '../i18n/index.js';

console.log(t('myCommand.title'));
console.log(t('myCommand.error', { error: 'Connection timeout' }));
```

### キー命名規約

```
common.*           共通ラベル（yes, no, none, error, hint）
category.*         操作カテゴリ（read, write, network, exec, other）
analyze.*          analyze コマンド出力
summary.*          summary コマンド出力
record.*           record コマンド出力
status.*           status コマンド出力
doctor.*           doctor コマンド出力
view.*             view コマンド出力
scan.*             scan コマンド出力
connectors.*       connectors コマンド出力
sessions.*         sessions コマンド出力
tree.*             tree コマンド出力
rpc.*              rpc コマンド出力
archive.*          archive コマンド出力
secrets.*          secrets コマンド出力
catalog.*          catalog コマンド出力
runners.*          runners コマンド出力
errors.*           ユーザー向けエラー
hints.*            ヒント/ガイダンス
```

### パラメータ補間

`{paramName}` 形式でパラメータを埋め込みます：

```typescript
// locales/en.ts
export const en = {
  common: {
    times: '{count} times',
  },
  analyze: {
    total: '{allowed} tools allowed, {count} calls',
  },
};

// 使用例
t('common.times', { count: 5 });  // "5 times"
t('analyze.total', { allowed: 3, count: 10 });  // "3 tools allowed, 10 calls"
```

### フォールバック動作

1. 現在のロケールでキーを検索
2. 見つからなければ英語(en)で検索
3. 英語でも見つからなければキー自体を返す

```typescript
// ja.ts にキーがない場合
PFSCAN_LANG=ja t('view.tableHeader')
// → en.ts の値 "Time         Sym Dir St..." がそのまま返される

// どちらにもない場合
t('nonexistent.key')
// → "nonexistent.key" がそのまま返される
```

### カテゴリラベルのヘルパー

```typescript
import { getCategoryLabel } from '../i18n/index.js';

// 言語設定に応じて適切なラベルを返す
getCategoryLabel('read');    // "Read" or "読み取り"
getCategoryLabel('exec');    // "Exec" or "コマンド実行"
```

## テスト

```bash
# i18n テストを実行
npm test -- src/i18n/i18n.test.ts

# 全テストを実行
npm test
```

## ファイル構成

```
src/i18n/
├── index.ts           # getLang(), t(), getAllKeys(), getCategoryLabel()
├── locales/
│   ├── en.ts          # 英語辞書（source of truth）
│   └── ja.ts          # 日本語辞書
└── i18n.test.ts       # テスト
```

## 関連コマンド

- `pfscan i18n keys` - 利用可能なキー一覧を表示
- `pfscan analyze` - セッション分析（i18n対応）
- `pfscan summary` - セッションサマリ（i18n対応）
- `pfscan record dry-run` - レコード候補表示（i18n対応）
